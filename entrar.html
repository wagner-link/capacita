<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cadastre-se no Capacita Arapiraca - Plataforma de qualifica√ß√£o profissional para jovens dos Tiros de Guerra">
    <meta name="keywords" content="cadastro, capacita arapiraca, qualifica√ß√£o profissional, tiro de guerra">
    <title>Cadastro - Capacita Arapiraca</title>
    <link rel="icon" href="/src/imgs/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/src/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&family=PT+Serif:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .register-page {
            min-height: 100vh;
            background: linear-gradient(135deg, #2c3e50, #007BFF);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
        }

        .register-container {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .register-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .register-header img {
            height: 80px;
            margin-bottom: 1rem;
        }

        .register-header h1 {
            font-family: 'PT Serif', serif;
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .register-header p {
            color: #6c757d;
            font-size: 1rem;
        }

        .user-type-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .user-type-card {
            padding: 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .user-type-card:hover {
            border-color: #007BFF;
            background: #e3f2fd;
        }

        .user-type-card.selected {
            border-color: #007BFF;
            background: #007BFF;
            color: white;
        }

        .user-type-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .user-type-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .user-type-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .form-section {
            display: none;
        }

        .form-section.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007BFF;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .military-fields {
            background: #f0f8ff;
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #007BFF;
            margin: 1rem 0;
            transition: all 0.3s ease;
        }

        .military-title {
            color: #007BFF;
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .military-title::before {
            content: "üéñÔ∏è";
            font-size: 1.2rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: #007BFF;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-loading {
            display: none;
            align-items: center;
            gap: 0.5rem;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .login-link {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e0e0e0;
        }

        .login-link a {
            color: #007BFF;
            text-decoration: none;
            font-weight: 500;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #c3e6cb;
        }

        @media (max-width: 768px) {
            .register-container {
                padding: 2rem 1.5rem;
                margin: 1rem;
            }

            .user-type-selection {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="register-page">
    <div class="register-container">
        <div class="register-header">
            <img src="/src/imgs/logo-arp.png" alt="Logo Capacita Arapiraca">
            <h1>Cadastro</h1>
            <p>Junte-se ao Capacita Arapiraca e transforme seu futuro profissional</p>
        </div>

        <div id="errorMessage" class="error-message" style="display: none;"></div>
        <div id="successMessage" class="success-message" style="display: none;"></div>

        <!-- Sele√ß√£o do tipo de usu√°rio -->
        <div class="user-type-selection">
            <div class="user-type-card" data-type="atirador">
                <div class="user-type-icon">üéñÔ∏è</div>
                <div class="user-type-title">Candidato</div>
                <div class="user-type-description">Jovem em busca de qualifica√ß√£o profissional</div>
            </div>
            <div class="user-type-card" data-type="empregador">
                <div class="user-type-icon">üè¢</div>
                <div class="user-type-title">Empresa</div>
                <div class="user-type-description">Empresa em busca de talentos qualificados</div>
            </div>
        </div>

        <!-- Formul√°rio para Candidatos -->
        <div id="candidateForm" class="form-section">
            <form id="candidateRegistrationForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="candidateName">Nome Completo *</label>
                        <input type="text" id="candidateName" name="nome" required>
                    </div>
                    <div class="form-group">
                        <label for="candidateSex">Sexo *</label>
                        <select id="candidateSex" name="sexo" required>
                            <option value="">Selecione</option>
                            <option value="feminino">Feminino</option>
                            <option value="masculino">Masculino</option>
                        </select>
                    </div>
                </div>

                <!-- Campos militares (aparecem apenas para sexo masculino) -->
                <div id="militaryFields" class="military-fields" style="display: none;">
                    <div class="military-title">Informa√ß√µes Militares</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="militaryStatus">Situa√ß√£o Militar *</label>
                            <select id="militaryStatus" name="situacaoMilitar">
                                <option value="">Selecione</option>
                                <option value="alistado-servindo">Alistado, matriculado e servindo</option>
                                <option value="reservista">Reservista conclu√≠do</option>
                                <option value="dispensado">Dispensado de corpora√ß√£o</option>
                                <option value="outra">Outra situa√ß√£o</option>
                            </select>
                        </div>
                        <div class="form-group" id="tiroGuerraGroup" style="display: none;">
                            <label for="tiroGuerra">Tiro de Guerra *</label>
                            <select id="tiroGuerra" name="tiroGuerra">
                                <option value="">Selecione</option>
                                <option value="TG 07-015 - Arapiraca">TG 07-015 - Arapiraca</option>
                                <option value="59¬∫ BI Mtz - Macei√≥">59¬∫ BI Mtz - Macei√≥</option>
                                <option value="TG 07-007 - Palmeira dos √çndios">TG 07-007 - Palmeira dos √çndios</option>
                                <option value="TG 07-008 - Penedo">TG 07-008 - Penedo</option>
                                <option value="TG 07-010 - Delmiro Gouveia">TG 07-010 - Delmiro Gouveia</option>
                                <option value="TG 07-022 - Teot√¥nio Vilela">TG 07-022 - Teot√¥nio Vilela</option>
                                <option value="TG 07-009 - S√£o Jos√© da Laje">TG 07-009 - S√£o Jos√© da Laje</option>
                                <option value="outro">Outro TG</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="outroTgGroup" style="display: none;">
                        <label for="outroTg">Especifique o Tiro de Guerra *</label>
                        <input type="text" id="outroTg" name="outroTg" placeholder="Digite o nome do seu Tiro de Guerra">
                    </div>
                    <div class="form-group" id="outraSituacaoGroup" style="display: none;">
                        <label for="outraSituacao">Especifique a situa√ß√£o *</label>
                        <input type="text" id="outraSituacao" name="outraSituacao" placeholder="Descreva sua situa√ß√£o militar">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="candidateEmail">Email *</label>
                        <input type="email" id="candidateEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="candidatePhone">Telefone *</label>
                        <input type="tel" id="candidatePhone" name="telefone" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="candidateCity">Cidade *</label>
                        <input type="text" id="candidateCity" name="cidade" required>
                    </div>
                    <div class="form-group">
                        <label for="candidateAge">Idade *</label>
                        <input type="number" id="candidateAge" name="idade" min="16" max="65" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="candidateEducation">Escolaridade *</label>
                    <select id="candidateEducation" name="escolaridade" required>
                        <option value="">Selecione</option>
                        <option value="fundamental-incompleto">Ensino Fundamental Incompleto</option>
                        <option value="fundamental-completo">Ensino Fundamental Completo</option>
                        <option value="medio-incompleto">Ensino M√©dio Incompleto</option>
                        <option value="medio-completo">Ensino M√©dio Completo</option>
                        <option value="superior-incompleto">Ensino Superior Incompleto</option>
                        <option value="superior-completo">Ensino Superior Completo</option>
                        <option value="pos-graduacao">P√≥s-gradua√ß√£o</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="candidateSkills">Habilidades *</label>
                    <textarea id="candidateSkills" name="habilidades" rows="3" placeholder="Descreva suas principais habilidades..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="candidateExperience">Experi√™ncia Profissional</label>
                    <textarea id="candidateExperience" name="experiencia" rows="3" placeholder="Descreva sua experi√™ncia profissional..."></textarea>
                </div>

                <div class="form-group">
                    <label for="candidateEducationDetails">Forma√ß√£o</label>
                    <textarea id="candidateEducationDetails" name="formacao" rows="3" placeholder="Descreva sua forma√ß√£o acad√™mica..."></textarea>
                </div>

                <div class="form-group">
                    <label for="candidatePassword">Senha *</label>
                    <input type="password" id="candidatePassword" name="senha" required minlength="6">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="backToSelection">Voltar</button>
                    <button type="submit" class="btn btn-primary" id="candidateSubmitBtn">
                        <span class="btn-text">Cadastrar</span>
                        <span class="btn-loading">
                            <span class="spinner"></span>
                            Cadastrando...
                        </span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Formul√°rio para Empresas -->
        <div id="employerForm" class="form-section">
            <form id="employerRegistrationForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="companyName">Nome da Empresa *</label>
                        <input type="text" id="companyName" name="nomeEmpresa" required>
                    </div>
                    <div class="form-group">
                        <label for="companyCnpj">CNPJ *</label>
                        <input type="text" id="companyCnpj" name="cnpj" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="companyEmail">Email *</label>
                        <input type="email" id="companyEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="companyPhone">Telefone *</label>
                        <input type="tel" id="companyPhone" name="telefone" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="companyCity">Cidade *</label>
                        <input type="text" id="companyCity" name="cidade" required>
                    </div>
                    <div class="form-group">
                        <label for="companySector">Setor *</label>
                        <select id="companySector" name="setor" required>
                            <option value="">Selecione o setor</option>
                            <option value="comercio">Com√©rcio</option>
                            <option value="servicos">Servi√ßos</option>
                            <option value="industria">Ind√∫stria</option>
                            <option value="tecnologia">Tecnologia</option>
                            <option value="saude">Sa√∫de</option>
                            <option value="educacao">Educa√ß√£o</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="companyInfo">Informa√ß√µes da Empresa</label>
                    <textarea id="companyInfo" name="informacoes" rows="4" placeholder="Descreva sua empresa, necessidades de contrata√ß√£o, etc..."></textarea>
                </div>

                <div class="form-group">
                    <label for="companyPassword">Senha *</label>
                    <input type="password" id="companyPassword" name="senha" required minlength="6">
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="backToSelectionEmployer">Voltar</button>
                    <button type="submit" class="btn btn-primary" id="employerSubmitBtn">
                        <span class="btn-text">Cadastrar Empresa</span>
                        <span class="btn-loading">
                            <span class="spinner"></span>
                            Cadastrando...
                        </span>
                    </button>
                </div>
            </form>
        </div>

        <div class="login-link">
            <p>J√° tem uma conta? <a href="#" id="loginLink">Fa√ßa login</a></p>
        </div>
    </div>

    <script>
        class RegistrationSystem {
            constructor() {
                this.apiUrl = '/api';
                this.selectedUserType = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                // Sele√ß√£o do tipo de usu√°rio
                document.querySelectorAll('.user-type-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        this.selectUserType(e.currentTarget.dataset.type);
                    });
                });

                // Bot√µes de voltar
                document.getElementById('backToSelection').addEventListener('click', () => {
                    this.showUserTypeSelection();
                });

                document.getElementById('backToSelectionEmployer').addEventListener('click', () => {
                    this.showUserTypeSelection();
                });

                // Formul√°rios
                document.getElementById('candidateRegistrationForm').addEventListener('submit', (e) => {
                    this.handleCandidateRegistration(e);
                });

                document.getElementById('employerRegistrationForm').addEventListener('submit', (e) => {
                    this.handleEmployerRegistration(e);
                });

                // Campos condicionais para candidatos
                document.getElementById('candidateSex').addEventListener('change', (e) => {
                    this.handleSexChange(e.target.value);
                });

                document.getElementById('militaryStatus').addEventListener('change', (e) => {
                    this.handleMilitaryStatusChange(e.target.value);
                });

                document.getElementById('tiroGuerra').addEventListener('change', (e) => {
                    this.handleTiroGuerraChange(e.target.value);
                });

                // Link de login
                document.getElementById('loginLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showLoginModal();
                });
            }

            selectUserType(type) {
                this.selectedUserType = type;
                
                // Atualizar visual da sele√ß√£o
                document.querySelectorAll('.user-type-card').forEach(card => {
                    card.classList.remove('selected');
                });
                document.querySelector(`[data-type="${type}"]`).classList.add('selected');

                // Mostrar formul√°rio correspondente
                setTimeout(() => {
                    this.showForm(type);
                }, 300);
            }

            showForm(type) {
                document.querySelector('.user-type-selection').style.display = 'none';
                
                if (type === 'atirador') {
                    document.getElementById('candidateForm').classList.add('active');
                } else {
                    document.getElementById('employerForm').classList.add('active');
                }
            }

            showUserTypeSelection() {
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                });
                document.querySelector('.user-type-selection').style.display = 'grid';
                this.selectedUserType = null;
                
                // Limpar sele√ß√£o visual
                document.querySelectorAll('.user-type-card').forEach(card => {
                    card.classList.remove('selected');
                });
            }

            handleSexChange(sex) {
                const militaryFields = document.getElementById('militaryFields');
                
                if (sex === 'masculino') {
                    militaryFields.style.display = 'block';
                    document.getElementById('militaryStatus').required = true;
                } else {
                    militaryFields.style.display = 'none';
                    document.getElementById('militaryStatus').required = false;
                    this.resetMilitaryFields();
                }
            }

            handleMilitaryStatusChange(status) {
                const tiroGuerraGroup = document.getElementById('tiroGuerraGroup');
                const outraSituacaoGroup = document.getElementById('outraSituacaoGroup');
                
                // Reset all conditional fields
                tiroGuerraGroup.style.display = 'none';
                outraSituacaoGroup.style.display = 'none';
                document.getElementById('tiroGuerra').required = false;
                document.getElementById('outraSituacao').required = false;
                
                if (status === 'alistado-servindo') {
                    tiroGuerraGroup.style.display = 'block';
                    document.getElementById('tiroGuerra').required = true;
                } else if (status === 'outra') {
                    outraSituacaoGroup.style.display = 'block';
                    document.getElementById('outraSituacao').required = true;
                }
            }

            handleTiroGuerraChange(tiroGuerra) {
                const outroTgGroup = document.getElementById('outroTgGroup');
                
                if (tiroGuerra === 'outro') {
                    outroTgGroup.style.display = 'block';
                    document.getElementById('outroTg').required = true;
                } else {
                    outroTgGroup.style.display = 'none';
                    document.getElementById('outroTg').required = false;
                }
            }

            resetMilitaryFields() {
                document.getElementById('militaryStatus').value = '';
                document.getElementById('tiroGuerra').value = '';
                document.getElementById('outroTg').value = '';
                document.getElementById('outraSituacao').value = '';
                
                document.getElementById('tiroGuerraGroup').style.display = 'none';
                document.getElementById('outroTgGroup').style.display = 'none';
                document.getElementById('outraSituacaoGroup').style.display = 'none';
            }

            async handleCandidateRegistration(e) {
                e.preventDefault();
                
                const submitBtn = document.getElementById('candidateSubmitBtn');
                this.showButtonLoading(submitBtn, true);
                
                try {
                    const formData = new FormData(e.target);
                    const candidateData = {
                        tipoUsuario: 'atirador'
                    };
                    
                    for (let [key, value] of formData.entries()) {
                        candidateData[key] = value;
                    }

                    const response = await fetch(`${this.apiUrl}/auth/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify(candidateData),
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || 'Erro ao cadastrar candidato');
                    }

                    this.showSuccess('Cadastro realizado com sucesso! Redirecionando...');
                    
                    setTimeout(() => {
                        window.location.href = '/dashboard/candidato.html';
                    }, 2000);

                } catch (error) {
                    console.error('Erro no cadastro:', error);
                    this.showError(error.message);
                } finally {
                    this.showButtonLoading(submitBtn, false);
                }
            }

            async handleEmployerRegistration(e) {
                e.preventDefault();
                
                const submitBtn = document.getElementById('employerSubmitBtn');
                this.showButtonLoading(submitBtn, true);
                
                try {
                    const formData = new FormData(e.target);
                    const employerData = {
                        tipoUsuario: 'empregador',
                        nome: formData.get('nomeEmpresa') // Usar nome da empresa como nome
                    };
                    
                    for (let [key, value] of formData.entries()) {
                        employerData[key] = value;
                    }

                    const response = await fetch(`${this.apiUrl}/auth/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify(employerData),
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || 'Erro ao cadastrar empresa');
                    }

                    this.showSuccess('Cadastro realizado com sucesso! Redirecionando...');
                    
                    setTimeout(() => {
                        window.location.href = '/dashboard/empregador.html';
                    }, 2000);

                } catch (error) {
                    console.error('Erro no cadastro:', error);
                    this.showError(error.message);
                } finally {
                    this.showButtonLoading(submitBtn, false);
                }
            }

            showButtonLoading(button, show) {
                const btnText = button.querySelector('.btn-text');
                const btnLoading = button.querySelector('.btn-loading');

                if (show) {
                    btnText.style.display = 'none';
                    btnLoading.style.display = 'flex';
                    button.disabled = true;
                } else {
                    btnText.style.display = 'block';
                    btnLoading.style.display = 'none';
                    button.disabled = false;
                }
            }

            showError(message) {
                const errorDiv = document.getElementById('errorMessage');
                errorDiv.textContent = message;
                errorDiv.style.display = 'block';
                
                document.getElementById('successMessage').style.display = 'none';
                
                // Scroll to top to show error
                document.querySelector('.register-container').scrollIntoView({ behavior: 'smooth' });
            }

            showSuccess(message) {
                const successDiv = document.getElementById('successMessage');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                
                document.getElementById('errorMessage').style.display = 'none';
                
                // Scroll to top to show success
                document.querySelector('.register-container').scrollIntoView({ behavior: 'smooth' });
            }

            showLoginModal() {
                // Implementar modal de login ou redirecionar
                alert('Funcionalidade de login ser√° implementada em breve!');
            }
        }

        // Inicializar sistema de registro
        document.addEventListener('DOMContentLoaded', () => {
            new RegistrationSystem();
        });
    </script>
</body>
</html>
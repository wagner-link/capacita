<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cadastre-se na plataforma Capacita TG como Atirador ou Empresa e tenha acesso a cursos e talentos.">
    <meta name="keywords" content="cadastro, entrar, registro, atirador, empresa, capacita tg">
    <title>Capacita Arapiraca - Cadastro</title>
    <link rel="icon" href="/src/imgs/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/src/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=PT+Serif:wght@700&display=swap" rel="stylesheet">
    <style>
        .register-section {
            padding: 4rem 0;
            background: #ecf0f1; /* Fundo cinza claro */
        }

        .register-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .register-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .register-header img {
            height: 120px;
            margin-bottom: 1rem;
        }

        .register-header h2 {
            font-family: 'PT Serif', serif;
            color: #2c3e50; /* Azul escuro */
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .register-header p {
            color: #7f8c8d; /* Cinza */
            font-size: 1.1rem;
        }

        .register-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50; /* Azul escuro */
            font-size: 1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Roboto', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007BFF; /* Laranja vibrante */
            box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
        }

        .user-type-container {
            display: flex;
            gap: 1rem;
        }

        .user-type-option {
            flex: 1;
            position: relative;
        }

        .user-type-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .user-type-label {
            display: block;
            padding: 1rem;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .user-type-option input[type="radio"]:checked + .user-type-label {
            background: #007BFF; /* Laranja vibrante */
            color: white;
            border-color: #007BFF; /* Laranja vibrante */
        }

        .user-type-label:hover {
            border-color: #007BFF; /* Laranja vibrante */
        }

        .dynamic-fields {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1.5rem;
            border-top: 2px solid #ecf0f1;
        }

        .dynamic-fields.active {
            display: flex;
        }

        .register-footer {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #ecf0f1;
        }

        .register-footer p {
            color: #7f8c8d; /* Cinza */
            margin-bottom: 1rem;
        }

        .register-footer a {
            color: #007BFF; /* Laranja vibrante */
            text-decoration: none;
            font-weight: 600;
        }

        .register-footer a:hover {
            text-decoration: underline;
        }

        .btn-primary {
            background: #007BFF; /* Laranja vibrante */
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #00a2ff; /* Laranja mais escuro */
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }

        .btn-secondary {
            background: #7f8c8d; /* Cinza */
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #95a5a6; /* Cinza mais claro */
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8) translateY(-50px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-header img {
            height: 80px;
            margin-bottom: 1rem;
        }

        .modal-header h3 {
            font-family: 'PT Serif', serif;
            color: #2c3e50; /* Azul escuro */
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .modal-header p {
            color: #7f8c8d; /* Cinza */
            font-size: 1rem;
        }

        .modal-content {
            margin-bottom: 2rem;
        }

        .modal-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .modal-info p {
            margin: 0.3rem 0;
            color: #34495e; /* Texto cinza escuro */
        }

        .modal-info strong {
            color: #2c3e50; /* Azul escuro */
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-actions .btn {
            flex: 1;
            max-width: 150px;
        }

        .btn-success {
            background: #2ecc71; /* Verde esmeralda */
            color: white;
        }

        .btn-success:hover {
            background: #27ae60; /* Verde escuro */
        }

        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-transition-exit {
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
        }

        .form-transition-enter {
            opacity: 1;
            transition: opacity 0.4s ease-in-out;
        }

        .form-fade {
            transition: opacity 0.4s ease-in-out;
        }

        @media (max-width: 768px) {
            .register-container {
                margin: 1rem;
                padding: 2rem;
            }

            .user-type-container {
                flex-direction: column;
            }

            .two-columns {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-branding">
                        <img src="/src/imgs/logo-arp.png" 
                             alt="Símbolo do Exército Brasileiro" 
                             class="logo-military">
                        <div class="brand-title-container">
                            <h1><a href="index.html">Capacita Arapiraca</a></h1>
                        </div>
                    </div>
                    
                    <nav class="main-nav">
                        <ul>
                            <li><a href="entrar.html" class="nav-link">Cadastre-se</a></li>
                            <li><a href="index.html#parceiros" class="nav-link">Sobre Nós</a></li>
                            <li><a href="index.html#parceira" class="nav-link">Parceiros</a></li>
                            <li><a href="https://web.arapiraca.al.gov.br/tipo-de-arquivo/vagas-do-sine/" class="nav-link" target="_blank">Vagas Sine Arapiraca</a></li>
                            <li><a href="index.html#contato" class="nav-link">Contato</a></li>
                        </ul>
                        
                        <div class="mobile-menu-items">
                            <button class="btn btn-login" id="mobileLoginBtn">Acessar</button>
                            <a href="/admin/index.html" class="btn btn-admin" target="_blank" rel="noopener noreferrer">Painel Admin</a>
                        </div>
                    </nav>
                </div>
                
                <div class="header-right">
                    <div class="header-actions">
                        <div class="search-container">
                            <input type="search" placeholder="Pesquisar..." aria-label="Pesquisar">
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="register-section">
            <div class="container">
                <div class="register-container" id="formContainer">
                    <div id="registrationContent">
                        <div class="register-header">
                            <img src="/src/imgs/logo-arp.png" alt="Logo Capacita TG">
                            <h2 id="formTitle">Cadastro de Informações</h2>
                            <p id="formSubtitle">Preencha seus dados para participar da plataforma Capacita Arapiraca</p>
                        </div>
                
                        <form class="register-form" id="registerForm">
                            <div class="form-group" id="userTypeGroup">
                                <label>Tipo de Usuário</label>
                                <div class="user-type-container">
                                    <div class="user-type-option">
                                        <input type="radio" id="atirador" name="tipoUsuario" value="atirador" required>
                                        <label for="atirador" class="user-type-label">Aluno</label>
                                    </div>
                                    <div class="user-type-option">
                                        <input type="radio" id="empregador" name="tipoUsuario" value="empregador" required>
                                        <label for="empregador" class="user-type-label">Empresa</label>
                                    </div>
                                </div>
                            </div>
                            <div id="atiradorFields" class="dynamic-fields">
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="nomeAtirador">Nome Completo *</label>
                                        <input type="text" id="nomeAtirador" name="nome" placeholder="Digite seu nome completo">
                                    </div>
                                    <div class="form-group">
                                        <label for="cidadeAtirador">Cidade *</label>
                                        <select id="cidadeAtirador" name="cidade" required>
                                            <option value="">Selecione sua cidade</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="emailAtirador">E-mail *</label>
                                        <input type="email" id="emailAtirador" name="email" placeholder="Digite seu e-mail">
                                    </div>
                                    <div class="form-group">
                                        <label for="telefoneAtirador">Telefone *</label>
                                        <input type="tel" id="telefoneAtirador" name="telefone" placeholder="(82) 99999-9999" required>
                                    </div>
                                </div>
                                
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="senhaAtirador">Senha *</label>
                                        <input type="password" id="senhaAtirador" name="senha" placeholder="Mínimo 6 caracteres" minlength="6">
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmaSenhaAtirador">Confirmar Senha *</label>
                                        <input type="password" id="confirmaSenhaAtirador" name="confirmaSenha" placeholder="Confirme sua senha">
                                    </div>
                                </div>
                
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="idadeAtirador">Idade *</label>
                                        <input type="number" id="idadeAtirador" name="idade" placeholder="Ex: 25" min="16" max="65" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="escolaridadeAtirador">Escolaridade *</label>
                                        <select id="escolaridadeAtirador" name="escolaridade" required>
                                            <option value="">Selecione sua escolaridade</option>
                                            <option value="fundamental-incompleto">Ensino Fundamental Incompleto</option>
                                            <option value="fundamental-completo">Ensino Fundamental Completo</option>
                                            <option value="medio-incompleto">Ensino Médio Incompleto</option>
                                            <option value="medio-completo">Ensino Médio Completo</option>
                                            <option value="superior-incompleto">Ensino Superior Incompleto</option>
                                            <option value="superior-completo">Ensino Superior Completo</option>
                                            <option value="pos-graduacao">Pós-graduação</option>
                                        </select>
                                    </div>
                                </div>
                
                                <div class="form-group">
                                    <label for="habilidadesAtirador">Habilidades *</label>
                                    <textarea id="habilidadesAtirador" name="habilidades" placeholder="Descreva suas principais habilidades e competências (ex: Liderança, Disciplina, Trabalho em equipe, etc.)"></textarea>
                                </div>
                
                                <div class="form-group">
                                    <label for="experienciaAtirador">Experiência Profissional</label>
                                    <textarea id="experienciaAtirador" name="experiencia" placeholder="Descreva sua experiência profissional relevante (empregos anteriores, projetos, etc.)"></textarea>
                                </div>
                
                                <div class="form-group">
                                    <label for="formacaoAtirador">Formação (Cursos e Certificações)</label>
                                    <textarea id="formacaoAtirador" name="formacao" placeholder="Liste sua formação acadêmica, cursos técnicos, certificações e treinamentos relevantes"></textarea>
                                </div>
                            </div>
                
                            <div id="empresaFields" class="dynamic-fields">
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="nomeEmpresa">Nome da Empresa *</label>
                                        <input type="text" id="nomeEmpresa" name="nomeEmpresa" placeholder="Digite o nome da empresa">
                                    </div>
                                    <div class="form-group">
                                        <label for="cnpjEmpresa">CNPJ *</label>
                                        <input type="text" id="cnpjEmpresa" name="cnpj" placeholder="00.000.000/0000-00" required>
                                    </div>
                                </div>
                
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="cidadeEmpresa">Cidade *</label>
                                        <select id="cidadeEmpresa" name="cidade" required>
                                            <option value="">Selecione a cidade da empresa</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="telefoneEmpresa">Telefone *</label>
                                        <input type="tel" id="telefoneEmpresa" name="telefone" placeholder="(82) 99999-9999" required>
                                    </div>
                                </div>
                
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="emailEmpresa">E-mail de Contato *</label>
                                        <input type="email" id="emailEmpresa" name="email" placeholder="Digite o e-mail de contato da empresa">
                                    </div>
                                    <div class="form-group">
                                        <label for="setorEmpresa">Setor de Atuação *</label>
                                        <select id="setorEmpresa" name="setor" required>
                                            <option value="">Selecione o setor</option>
                                            <option value="comercio">Comércio</option>
                                            <option value="servicos">Serviços</option>
                                            <option value="industria">Indústria</option>
                                            <option value="tecnologia">Tecnologia</option>
                                            <option value="saude">Saúde</option>
                                            <option value="educacao">Educação</option>
                                            <option value="outros">Outros</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="senhaEmpresa">Senha *</label>
                                        <input type="password" id="senhaEmpresa" name="senha" placeholder="Mínimo 6 caracteres" minlength="6">
                                    </div>
                                    <div class="form-group">
                                        <label for="confirmaSenhaEmpresa">Confirmar Senha *</label>
                                        <input type="password" id="confirmaSenhaEmpresa" name="confirmaSenha" placeholder="Confirme sua senha">
                                    </div>
                                </div>
                
                                <div class="form-group">
                                    <label for="informacoesEmpresa">Necessidades Específicas</label>
                                    <textarea id="informacoesEmpresa" name="informacoes" placeholder="Descreva as necessidades específicas da empresa, tipos de profissionais procurados, requisitos especiais e outras informações relevantes"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Cadastrar Informações</button>
                        </form>
                
                        <div class="register-footer">
                            <p id="toggleFormText">Já possui uma conta? <a href="#" id="toggleFormLink">Fazer Login</a></p>
                        </div>
                    </div>
                    
                    <div id="loginContent" style="display: none;">
                        <div class="register-header">
                            <img src="/src/imgs/logo-arp.png" alt="Logo Capacita TG">
                            <h2>Fazer Login</h2>
                            <p>Entre com suas credenciais para acessar a plataforma</p>
                        </div>
                        <form class="register-form" id="loginForm">
                            <div class="form-group">
                                <label for="loginEmail">E-mail</label>
                                <input type="email" id="loginEmail" required placeholder="Digite seu e-mail">
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Senha</label>
                                <input type="password" id="loginPassword" required placeholder="Digite sua senha">
                            </div>
                            <button type="submit" class="btn btn-primary">Entrar</button>
                        </form>
                        <div class="register-footer">
                            <p>Não tem uma conta? <a href="#" id="toggleLoginLink">Cadastre-se</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/logo-arp.png" alt="Logo Capacita TG">
                <h3>Fazer Login</h3>
                <p>Entre com suas credenciais</p>
            </div>
            <div class="modal-content">
                <form id="loginFormModal">
                    <div class="form-group">
                        <label for="loginEmailModal">Email</label>
                        <input type="email" id="loginEmailModal" required placeholder="Digite seu email">
                    </div>
                    <div class="form-group">
                        <label for="loginPasswordModal">Senha</label>
                        <input type="password" id="loginPasswordModal" required placeholder="Digite sua senha">
                    </div>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="closeLoginModal">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/logo-arp.png" 
                     alt="Logo Capacita TG">
                <h3 id="successTitle">Informações Cadastradas!</h3>
                <p id="successMessage">Seus dados foram registrados com sucesso!</p>
            </div>
            <div class="modal-content">
                <div class="modal-info" id="userDataDisplay">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-success" id="closeSuccessModal">Continuar</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="errorModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/logo-arp.png" 
                     alt="Logo Capacita TG">
                <h3 id="errorTitle">Erro!</h3>
                <p id="errorMessage">Ocorreu um erro</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="closeErrorModal">OK</button>
            </div>
        </div>
    </div>


    <footer id="contato">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3>Capacita Arapiraca</h3>
                    <p>Sua jornada de sucesso começa aqui.</p>
                    <p><span itemprop="streetAddress">R. Eng. Godilho de Castro, 1234 - Centro, Arapiraca - AL, 57300-100</span>,
                </div>
                <div class="footer-col">
                    <h4>Links Rápidos</h4>
                    <ul>
                        <li><a href="entrar.html" class="nav-link">Cadastre-se</a></li>
                        <li><a href="index.html#parceiros" class="nav-link">Sobre Nós</a></li>
                        <li><a href="index.html#parceira" class="nav-link">Parceiros</a></li>
                        <li><a href="https://web.arapiraca.al.gov.br/tipo-de-arquivo/vagas-do-sine/" class="nav-link" target="_blank">Vagas Sine Arapiraca</a></li>
                        <li><a href="#contato" class="nav-link">Contato</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contato</h4>
                    <p>Email plataforma: capacitaarapiraca0@gmail.com</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/sine_municipal_de_arapiraca/" target="_blank">Instagram</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024-2025 CapacitaArapiraca. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script>
        const CIDADES_TG = Object.freeze({
            'arapiraca': { nome: 'Arapiraca', tg: '07-015' }
        });

        class CapacitaTGManager {
            constructor() {
                this.apiUrl = '/api';
                this.currentCity = null;
                this.currentUserType = null;
                this.loginAction = false;
                this.init();
                this.setupConditionalFields();
            }

            init() {
                this.setupEventListeners();
                this.populateCitySelects();
            }

            setupConditionalFields() {
                // Listener para campo de sexo do atirador
                document.getElementById('sexoAtirador').addEventListener('change', (e) => {
                    this.handleSexoChange(e.target.value, 'atirador');
                });

                // Listener para situação militar
                document.getElementById('situacaoMilitarAtirador').addEventListener('change', (e) => {
                    this.handleSituacaoMilitarChange(e.target.value);
                });

                // Listener para tiro de guerra
                document.getElementById('tiroGuerraAtirador').addEventListener('change', (e) => {
                    this.handleTiroGuerraChange(e.target.value);
                });
            }

            handleSexoChange(sexo, tipo) {
                const situacaoGroup = document.getElementById('situacaoMilitarGroup');
                const situacaoSelect = document.getElementById('situacaoMilitarAtirador');
                
                if (tipo === 'atirador' && sexo === 'masculino') {
                    situacaoGroup.style.display = 'block';
                    situacaoSelect.setAttribute('required', '');
                } else {
                    situacaoGroup.style.display = 'none';
                    situacaoSelect.removeAttribute('required');
                    situacaoSelect.value = '';
                    
                    // Esconder campos dependentes
                    this.hideConditionalFields();
                }
            }

            handleSituacaoMilitarChange(situacao) {
                const tiroGuerraGroup = document.getElementById('tiroGuerraGroup');
                const tiroGuerraSelect = document.getElementById('tiroGuerraAtirador');
                const outraSituacaoGroup = document.getElementById('outraSituacaoGroup');
                const outraSituacaoInput = document.getElementById('outraSituacaoAtirador');
                
                // Reset campos
                this.hideConditionalFields();
                
                if (situacao === 'matriculado e servindo') {
                    tiroGuerraGroup.style.display = 'block';
                    tiroGuerraSelect.setAttribute('required', '');
                } else if (situacao === 'outra') {
                    outraSituacaoGroup.style.display = 'block';
                    outraSituacaoInput.setAttribute('required', '');
                }
            }

            handleTiroGuerraChange(tiroGuerra) {
                const outroTgGroup = document.getElementById('outroTgGroup');
                const outroTgInput = document.getElementById('outroTgAtirador');
                
                if (tiroGuerra === 'outro') {
                    outroTgGroup.style.display = 'block';
                    outroTgInput.setAttribute('required', '');
                } else {
                    outroTgGroup.style.display = 'none';
                    outroTgInput.removeAttribute('required');
                    outroTgInput.value = '';
                }
            }

            hideConditionalFields() {
                ['tiroGuerraGroup', 'outroTgGroup', 'outraSituacaoGroup'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.display = 'none';
                        const input = element.querySelector('input, select');
                        if (input) {
                            input.removeAttribute('required');
                            input.value = '';
                        }
                    }
                });
            }

            populateCitySelects() {
                const selects = ['cidadeAtirador', 'cidadeEmpresa'];
                
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (!select) return;

                    select.innerHTML = '<option value="">Selecione a cidade</option>';
                    const fragment = document.createDocumentFragment();
                    
                    Object.entries(CIDADES_TG).forEach(([key, { nome, tg }]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = nome;
                        option.dataset.tg = tg;
                        fragment.appendChild(option);
                    });

                    select.appendChild(fragment);
                });
            }

            setupEventListeners() {
                document.addEventListener('change', this.handleFormChanges.bind(this));
                document.getElementById('registerForm').addEventListener('submit', this.handleRegistrationSubmit.bind(this));
                document.getElementById('loginForm').addEventListener('submit', this.handleLoginSubmit.bind(this));
                document.getElementById('loginFormModal').addEventListener('submit', this.handleLoginSubmit.bind(this));
                document.getElementById('toggleFormLink').addEventListener('click', this.toggleForms.bind(this));
                document.getElementById('toggleLoginLink').addEventListener('click', this.toggleForms.bind(this));
                document.getElementById('closeSuccessModal').addEventListener('click', () => {
                    this.hideModal('successModal');
                    if (!this.loginAction) {
                        window.location.href = 'index.html';
                    }
                });
                document.getElementById('closeErrorModal').addEventListener('click', () => this.hideModal('errorModal'));
                document.getElementById('closeLoginModal').addEventListener('click', () => this.hideModal('loginModal'));

                // Handles input masks
                document.addEventListener('input', (event) => {
                    if (event.target.id === 'telefoneAtirador' || event.target.id === 'telefoneEmpresa') {
                        this.applyPhoneMask(event.target);
                    } else if (event.target.id === 'cnpjEmpresa') {
                        this.applyCNPJMask(event.target);
                    }
                });

                document.querySelectorAll('.modal-overlay').forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            this.hideModal(overlay.id);
                        }
                    });
                });
            }

            toggleForms(event) {
                event.preventDefault();
                const registrationContent = document.getElementById('registrationContent');
                const loginContent = document.getElementById('loginContent');

                if (registrationContent.style.display !== 'none') {
                    // Fade out do formulário de registro
                    registrationContent.style.opacity = '0';
                    
                    // Esconde o formulário de registro e mostra o de login após a transição
                    setTimeout(() => {
                        registrationContent.style.display = 'none';
                        loginContent.style.display = 'block';

                        // Adiciona a classe para a transição de entrada
                        loginContent.classList.add('form-fade');
                        loginContent.style.opacity = '1';
                    }, 400); // 400ms para corresponder à duração da transição
                    
                } else {
                    // Remove a classe de transição do formulário atual para que a próxima animação funcione corretamente
                    loginContent.classList.remove('form-fade');
                    loginContent.style.opacity = '0';
                    
                    // Esconde o formulário de login e mostra o de registro após a transição
                    setTimeout(() => {
                        loginContent.style.display = 'none';
                        registrationContent.style.display = 'block';
                        
                        // Adiciona a classe para a transição de entrada
                        registrationContent.classList.add('form-fade');
                        registrationContent.style.opacity = '1';
                    }, 400); // 400ms para corresponder à duração da transição
                }
            }


            handleFormChanges(event) {
                const { target } = event;
                
                if (target.name === 'tipoUsuario') {
                    this.handleUserTypeChange(target.value);
                } else if (target.name === 'cidade') {
                    this.handleCityChange(target.value);
                }
            }

            handleUserTypeChange(userType) {
                this.currentUserType = userType;
                this.toggleUserTypeFields(userType);
                this.setRequiredFields(userType);
            }

            handleCityChange(cityKey) {
                this.currentCity = cityKey;
            }

            applyPhoneMask(input) {
                let value = input.value.replace(/\D/g, '');
                if (value.length > 11) { value = value.slice(0, 11); }
                if (value.length >= 11) {
                    input.value = value.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 10) {
                    input.value = value.replace(/^(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 6) {
                    input.value = value.replace(/^(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
                } else if (value.length >= 2) {
                    input.value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
                } else {
                    input.value = value;
                }
            }

            applyCNPJMask(input) {
                let value = input.value.replace(/\D/g, '');
                if (value.length > 14) { value = value.slice(0, 14); }
                if (value.length >= 14) {
                    input.value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
                } else if (value.length >= 12) {
                    input.value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{0,2})/, '$1.$2.$3/$4-$5');
                } else if (value.length >= 8) {
                    input.value = value.replace(/^(\d{2})(\d{3})(\d{3})(\d{0,4})/, '$1.$2.$3/$4');
                } else if (value.length >= 5) {
                    input.value = value.replace(/^(\d{2})(\d{3})(\d{0,3})/, '$1.$2.$3');
                } else if (value.length >= 2) {
                    input.value = value.replace(/^(\d{2})(\d{0,3})/, '$1.$2');
                } else {
                    input.value = value;
                }
            }

            toggleUserTypeFields(userType) {
                const fieldsMap = {
                    'atirador': 'atiradorFields',
                    'empregador': 'empresaFields'
                };

                Object.values(fieldsMap).forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.classList.remove('active');
                });

                const targetField = document.getElementById(fieldsMap[userType]);
                if (targetField) {
                    setTimeout(() => targetField.classList.add('active'), 50);
                }
            }

            setRequiredFields(userType) {
                document.querySelectorAll('.dynamic-fields input, .dynamic-fields textarea, .dynamic-fields select')
                    .forEach(field => {
                        field.removeAttribute('required');
                        if (field.type === 'password') {
                            field.removeAttribute('minlength');
                        }
                    });

                const requiredFields = {
                    'atirador': ['nomeAtirador', 'cidadeAtirador', 'emailAtirador', 'telefoneAtirador', 'idadeAtirador', 'escolaridadeAtirador', 'habilidadesAtirador', 'senhaAtirador', 'confirmaSenhaAtirador', 'sexoAtirador'],
                    'empregador': ['nomeEmpresa', 'cnpjEmpresa', 'cidadeEmpresa', 'telefoneEmpresa', 'emailEmpresa', 'setorEmpresa', 'senhaEmpresa', 'confirmaSenhaEmpresa', 'sexoEmpresa']
                };

                requiredFields[userType]?.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.setAttribute('required', '');
                        if (field.type === 'password') {
                            field.setAttribute('minlength', '6');
                        }
                    }
                });

                // Verificar campos condicionais
                if (userType === 'atirador') {
                    const sexo = document.getElementById('sexoAtirador').value;
                    const situacao = document.getElementById('situacaoMilitarAtirador').value;
                    const tiroGuerra = document.getElementById('tiroGuerraAtirador').value;
                    
                    this.handleSexoChange(sexo, 'atirador');
                    this.handleSituacaoMilitarChange(situacao);
                    this.handleTiroGuerraChange(tiroGuerra);
                }
            }

            async handleRegistrationSubmit(event) {
                event.preventDefault();
                this.loginAction = false;
                
                if (!this.validateRegistrationForm()) {
                    return;
                }

                const userData = this.collectUserData();
                await this.registerUser(userData);
            }

            validateRegistrationForm() {
                const form = document.getElementById('registerForm');
                const isValid = form.checkValidity();
                
                if (!isValid) {
                    form.reportValidity();
                    return false;
                }

                const userType = this.currentUserType;
                if (!userType) {
                    this.showErrorMessage('Por favor, selecione o tipo de usuário.');
                    return false;
                }
                
                const senha = document.getElementById(`senha${userType === 'atirador' ? 'Atirador' : 'Empresa'}`).value;
                const confirmaSenha = document.getElementById(`confirmaSenha${userType === 'atirador' ? 'Atirador' : 'Empresa'}`).value;

                if (senha !== confirmaSenha) {
                    this.showErrorMessage('As senhas não coincidem.');
                    return false;
                }

                if (senha.length < 6) {
                    this.showErrorMessage('A senha deve ter no mínimo 6 caracteres.');
                    return false;
                }

                // Validações condicionais
                if (userType === 'atirador') {
                    const sexo = document.getElementById('sexoAtirador').value;
                    if (sexo === 'masculino') {
                        const situacao = document.getElementById('situacaoMilitarAtirador').value;
                        if (!situacao) {
                            this.showErrorMessage('Por favor, selecione sua situação militar.');
                            return false;
                        }
                        if (situacao === 'matriculado e servindo' && !document.getElementById('tiroGuerraAtirador').value) {
                            this.showErrorMessage('Por favor, selecione seu Tiro de Guerra.');
                            return false;
                        }
                    }
                }

                return true;
            }

            collectUserData() {
                const userType = this.currentUserType;
                const cityData = CIDADES_TG[this.currentCity];
                
                const baseData = {
                    tipoUsuario: userType,
                    cidade: cityData ? cityData.nome : '',
                };

                if (userType === 'atirador') {
                    return { ...baseData, ...this.getAtiradorData() };
                } else {
                    return { ...baseData, ...this.getEmpresaData() };
                }
            }

            getAtiradorData() {
                return {
                    nome: document.getElementById('nomeAtirador').value.trim(),
                    email: document.getElementById('emailAtirador').value.trim(),
                    sexo: document.getElementById('sexoAtirador').value.trim(),
                    situacaoMilitar: this.getSituacaoMilitar(),
                    tiroGuerra: this.getTiroGuerra(),
                    telefone: document.getElementById('telefoneAtirador').value.trim(),
                    idade: document.getElementById('idadeAtirador').value.trim(),
                    escolaridade: document.getElementById('escolaridadeAtirador').value.trim(),
                    habilidades: document.getElementById('habilidadesAtirador').value.trim(),
                    experiencia: document.getElementById('experienciaAtirador').value.trim(),
                    formacao: document.getElementById('formacaoAtirador').value.trim(),
                    senha: document.getElementById('senhaAtirador').value
                };
            }

            getSituacaoMilitar() {
                const sexo = document.getElementById('sexoAtirador').value;
                if (sexo !== 'masculino') return null;
                
                const situacao = document.getElementById('situacaoMilitarAtirador').value;
                if (situacao === 'outra') {
                    return document.getElementById('outraSituacaoAtirador').value.trim();
                }
                return situacao;
            }

            getTiroGuerra() {
                const situacao = document.getElementById('situacaoMilitarAtirador').value;
                if (situacao !== 'matriculado e servindo') return null;
                
                const tiroGuerra = document.getElementById('tiroGuerraAtirador').value;
                if (tiroGuerra === 'outro') {
                    return document.getElementById('outroTgAtirador').value.trim();
                }
                return tiroGuerra;
            }

            getEmpresaData() {
                return {
                    nomeEmpresa: document.getElementById('nomeEmpresa').value.trim(),
                    sexo: document.getElementById('sexoEmpresa').value.trim(),
                    cnpj: document.getElementById('cnpjEmpresa').value.trim(),
                    telefone: document.getElementById('telefoneEmpresa').value.trim(),
                    email: document.getElementById('emailEmpresa').value.trim(),
                    setor: document.getElementById('setorEmpresa').value.trim(),
                    informacoes: document.getElementById('informacoesEmpresa').value.trim(),
                    senha: document.getElementById('senhaEmpresa').value
                };
            }

            async registerUser(userData) {
                try {
                    this.showLoadingState(true);
                    
                    const registerData = {
                        nome: userData.nome || userData.nomeEmpresa,
                        email: userData.email,
                        senha: userData.senha,
                        tipoUsuario: userData.tipoUsuario,
                        ...userData
                    };

                    const response = await fetch(`${this.apiUrl}/auth/register`, {
                        method: 'POST',
                        credentials: 'include',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(registerData)
                    });

                    const responseData = await response.json();

                    if (!response.ok) {
                        throw new Error(responseData.error || 'Erro ao cadastrar dados');
                    }

                    this.showSuccessModal(responseData.user);
                    this.clearForm();
                    
                } catch (error) {
                    console.error('Error submitting to API:', error);
                    this.showErrorMessage(error.message || 'Erro ao cadastrar. Tente novamente.');
                } finally {
                    this.showLoadingState(false);
                }
            }
            
            async handleLoginSubmit(event) {
                event.preventDefault();
                this.loginAction = true;
                
                const email = document.getElementById('loginEmail').value || document.getElementById('loginEmailModal').value;
                const senha = document.getElementById('loginPassword').value || document.getElementById('loginPasswordModal').value;

                try {
                    const response = await fetch(`${this.apiUrl}/auth/login`, {
                        method: 'POST',
                        credentials: 'include',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, senha })
                    });
                    
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.error || 'Erro ao fazer login.');
                    }
                    
                    this.hideModal('loginModal');
                    this.showSuccessModal({ ...data.user, login: true });
                    
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                } catch (error) {
                    console.error('Error logging in:', error);
                    this.showErrorMessage(error.message || 'Email ou senha incorretos.');
                }
            }
            
            showLoadingState(show) {
                const submitBtn = document.querySelector('button[type="submit"]');
                if (show) {
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Aguarde...';
                } else {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Cadastrar Informações';
                }
            }

            showErrorMessage(message) {
                const errorModal = document.getElementById('errorModal');
                document.getElementById('errorMessage').textContent = message;
                this.showModal('errorModal');
            }

            clearForm() {
                const form = document.getElementById('registerForm');
                if (form) {
                    form.reset();
                    this.currentCity = null;
                    this.currentUserType = null;
                    
                    ['atiradorFields', 'empresaFields'].forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.classList.remove('active');
                    });
                }
            }

            showSuccessModal(userData) {
                const modalInfo = this.buildSuccessModalContent(userData);
                const userDataDisplay = document.getElementById('userDataDisplay');
                const successMessage = document.getElementById('successMessage');
                const successTitle = document.getElementById('successTitle');

                if (userDataDisplay) {
                    userDataDisplay.innerHTML = modalInfo.dataHTML;
                }
                if (successMessage) {
                    successMessage.textContent = modalInfo.message;
                }
                if(successTitle){
                    successTitle.textContent = userData.login ? 'Login Efetuado!' : 'Informações Cadastradas!';
                }


                this.showModal('successModal');
            }

            buildSuccessModalContent(userData) {
                const isAtirador = userData.tipoUsuario === 'atirador';
                
                const dataHTML = isAtirador ? `
                    <p><strong>Nome:</strong> ${userData.nome}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Telefone:</strong> ${userData.telefone}</p>
                    <p><strong>Tipo:</strong> Aluno</p>
                ` : `
                    <p><strong>Empresa:</strong> ${userData.nomeEmpresa}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Tipo:</strong> Empresa</p>
                `;

                const message = userData.login
                    ? 'Login realizado com sucesso! Bem-vindo(a) de volta!'
                    : 'Cadastro realizado com sucesso! Você já está logado no sistema.';

                return { dataHTML, message };
            }

            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }

            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new CapacitaTGManager();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cadastre-se ou faÃ§a login na plataforma Capacita TG como Atirador ou Empresa e tenha acesso a cursos e talentos.">
    <meta name="keywords" content="cadastro, entrar, registro, atirador, empresa, login, capacita tg">
    <title>Capacita ARP - Acesso</title>
    <link rel="icon" href="/src/imgs/favicon.ico" type="image-x-icon">
    <link rel="stylesheet" href="/src/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=PT+Serif:wght@700&display=swap" rel="stylesheet">
    <style>
        .register-section {
            padding: 4rem 0;
            background: #ecf0f1;
        }

        .register-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
        }

        .register-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .register-header img {
            height: 120px;
            margin-bottom: 1rem;
        }

        .register-header h2 {
            font-family: 'PT Serif', serif;
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .register-header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .form-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e0e0e0;
            position: relative;
            overflow: hidden;
        }

        .form-toggle::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50%;
            height: 3px;
            background: #007BFF;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(0);
        }

        .form-toggle.register-active::after {
            transform: translateX(100%);
        }
        .form-toggle-button {
            background: none;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .form-toggle-button.active {
            color: #007BFF;
            transform: scale(1.05);
        }

        .form-section {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .form-section.entering {
            animation: slideInUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .form-section.leaving {
            animation: slideOutDown 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideOutDown {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }
        .register-form, .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            position: relative;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Roboto', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007BFF;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .form-group.error label {
            color: #dc3545;
        }

        .form-group .input-feedback {
            font-size: 0.9rem;
            color: red;
            display: none;
            margin-top: 0.25rem;
            padding: 0.5rem;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 4px;
            border-left: 3px solid #dc3545;
        }

        .form-group .input-feedback.show {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-type-container {
            display: flex;
            gap: 1rem;
        }

        .user-type-option {
            flex: 1;
            position: relative;
        }

        .user-type-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .user-type-label {
            display: block;
            padding: 1rem;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .user-type-label::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 123, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .user-type-option input[type="radio"]:checked + .user-type-label {
            background: #007BFF;
            color: white;
            border-color: #007BFF;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .user-type-option input[type="radio"]:checked + .user-type-label::before {
            left: 100%;
        }

        .user-type-label:hover {
            border-color: #007BFF;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .dynamic-fields {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1rem;
            padding-top: 1.5rem;
            border-top: 2px solid #ecf0f1;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dynamic-fields.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .register-footer {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #ecf0f1;
        }

        .register-footer p {
            color: #7f8c8d;
            margin-bottom: 1rem;
        }

        .register-footer a {
            color: #007BFF;
            text-decoration: none;
            font-weight: 600;
        }

        .register-footer a:hover {
            text-decoration: underline;
        }

        .btn-primary {
            background: #007BFF;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover {
            background: #00a2ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:disabled {
            background: #b1d4ff;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-primary.loading {
            pointer-events: none;
            position: relative;
        }

        .btn-primary.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-secondary {
            background: #7f8c8d;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #95a5a6;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.8) translateY(-50px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .modal-header img {
            height: 80px;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
        }

        .modal-header h3 {
            font-family: 'PT Serif', serif;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .modal-header p {
            color: #7f8c8d;
            font-size: 1rem;
        }

        .modal-content {
            margin-bottom: 2rem;
        }

        .modal-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #007BFF;
        }

        .modal-info p {
            margin: 0.3rem 0;
            color: #34495e;
        }

        .modal-info strong {
            color: #2c3e50;
        }
        
        .modal-content .error-message {
            color: #dc3545;
            font-size: 0.9rem;
            text-align: center;
            margin-top: -1rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .modal-actions .btn {
            flex: 1;
            max-width: 150px;
        }

        .btn-success {
            background: #2ecc71;
            color: white;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 204, 113, 0.4);
        }

        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* Loading states */
        .form-loading {
            pointer-events: none;
            opacity: 0.7;
        }

        .form-loading .btn-primary {
            background: #6c757d;
        }

        /* Success states */
        .form-success .form-group input,
        .form-success .form-group select,
        .form-success .form-group textarea {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.05);
        }

        @media (max-width: 768px) {
            .register-container {
                margin: 1rem;
                padding: 2rem;
            }

            .user-type-container {
                flex-direction: column;
            }

            .two-columns {
                grid-template-columns: 1fr;
            }

            .form-toggle-button {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-branding">
                        <img src="/src/imgs/logo-arp.png" 
                             alt="SÃ­mbolo do ExÃ©rcito Brasileiro" 
                             class="logo-military">
                        <div class="brand-title-container">
                            <h1><a href="index.html">Capacita Arapiraca</a></h1>
                        </div>
                    </div>
                    
                    <nav class="main-nav">
                        <ul>
                            <li><a href="entrar.html" class="nav-link">Cadastre-se</a></li>
                            <li><a href="index.html#parceiros" class="nav-link">Sobre NÃ³s</a></li>
                            <li><a href="index.html#parceira" class="nav-link">Parceiros</a></li>
                            <li><a href="index.html#contato" class="nav-link">Contato</a></li>
                        </ul>
                        
                        <div class="mobile-menu-items">
                            <button class="btn btn-login" id="mobileLoginBtn">Acessar</button>
                            <a href="/admin/index.html" class="btn btn-admin" target="_blank" rel="noopener noreferrer">Painel Admin</a>
                        </div>
                    </nav>
                </div>
                
                <div class="header-right">
                    <div class="header-actions">
                        <div class="search-container">
                            <input type="search" placeholder="Pesquisar..." aria-label="Pesquisar">
                        </div>
                        <a href="/entrar.html" class="btn btn-login" id="headerLoginBtn">Acessar</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="register-section">
            <div class="container">
                <div class="register-container">
                    <div class="register-header">
                        <img src="/src/imgs/logo-arp.png" 
                             alt="Logo Capacita TG">
                        <h2>Acesso Ã  Plataforma</h2>
                        <p>FaÃ§a login ou cadastre-se para comeÃ§ar</p>
                    </div>

                    <div class="form-toggle">
                        <button id="showLogin" class="form-toggle-button active">Login</button>
                        <button id="showRegister" class="form-toggle-button">Cadastre-se</button>
                    </div>

                    <div class="form-section active" id="loginSection">
                        <form class="login-form" id="loginForm">
                            <div class="form-group">
                                <label for="loginEmail">E-mail</label>
                                <input type="email" id="loginEmail" name="email" placeholder="Digite seu e-mail" required>
                                <span class="input-feedback" id="loginEmailFeedback">E-mail nÃ£o pode ficar vazio.</span>
                            </div>

                            <div class="form-group">
                                <label for="loginSenha">Senha</label>
                                <input type="password" id="loginSenha" name="senha" placeholder="Digite sua senha" required>
                                <span class="input-feedback" id="loginSenhaFeedback">Senha nÃ£o pode ficar vazia.</span>
                            </div>

                            <button type="submit" class="btn btn-primary" id="loginBtn">
                                <span class="btn-text">Acessar</span>
                            </button>
                        </form>
                    </div>

                    <div class="form-section" id="registerSection">
                        <form class="register-form" id="registerForm">
                            <div class="form-group">
                                <label>Tipo de UsuÃ¡rio</label>
                                <div class="user-type-container">
                                    <div class="user-type-option">
                                        <input type="radio" id="atirador" name="tipoUsuario" value="atirador" required>
                                        <label for="atirador" class="user-type-label">
                                            Aluno
                                        </label>
                                    </div>
                                    <div class="user-type-option">
                                        <input type="radio" id="empregador" name="tipoUsuario" value="empregador" required>
                                        <label for="empregador" class="user-type-label">
                                            Empresa
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div id="atiradorFields" class="dynamic-fields">
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="nomeAtirador">Nome Completo *</label>
                                        <input type="text" id="nomeAtirador" name="nome" placeholder="Digite seu nome completo">
                                    </div>
                                    <div class="form-group">
                                        <label for="cidadeAtirador">Cidade *</label>
                                        <select id="cidadeAtirador" name="cidade" required>
                                            <option value="">Selecione sua cidade</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="emailAtirador">E-mail *</label>
                                        <input type="email" id="emailAtirador" name="email" placeholder="Digite seu e-mail">
                                    </div>
                                    <div class="form-group">
                                        <label for="telefoneAtirador">Telefone *</label>
                                        <input type="tel" id="telefoneAtirador" name="telefone" placeholder="(82) 99999-9999" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="senhaAtirador">Senha *</label>
                                    <input type="password" id="senhaAtirador" name="senha" placeholder="Crie uma senha" required>
                                </div>

                                <div class="form-group">
                                    <label for="habilidadesAtirador">Habilidades *</label>
                                    <textarea id="habilidadesAtirador" name="habilidades" placeholder="Descreva suas principais habilidades e competÃªncias (ex: LideranÃ§a, Disciplina, Trabalho em equipe, etc.)"></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="experienciaAtirador">ExperiÃªncia Profissional</label>
                                    <textarea id="experienciaAtirador" name="experiencia" placeholder="Descreva sua experiÃªncia profissional relevante (empregos anteriores, projetos, etc.)"></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="formacaoAtirador">FormaÃ§Ã£o (Cursos e CertificaÃ§Ãµes)</label>
                                    <textarea id="formacaoAtirador" name="formacao" placeholder="Liste sua formaÃ§Ã£o acadÃªmica, cursos tÃ©cnicos, certificaÃ§Ãµes e treinamentos relevantes"></textarea>
                                </div>
                            </div>

                            <div id="empresaFields" class="dynamic-fields">
                                <div class="two-columns">
                                    <div class="form-group">
                                        <label for="nomeEmpresa">Nome da Empresa *</label>
                                        <input type="text" id="nomeEmpresa" name="nomeEmpresa" placeholder="Digite o nome da empresa">
                                    </div>
                                    <div class="form-group">
                                        <label for="cidadeEmpresa">Cidade *</label>
                                        <select id="cidadeEmpresa" name="cidade" required>
                                            <option value="">Selecione a cidade da empresa</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="emailEmpresa">E-mail de Contato *</label>
                                    <input type="email" id="emailEmpresa" name="email" placeholder="Digite o e-mail de contato da empresa">
                                </div>
                                
                                <div class="form-group">
                                    <label for="senhaEmpresa">Senha *</label>
                                    <input type="password" id="senhaEmpresa" name="senha" placeholder="Crie uma senha" required>
                                </div>

                                <div class="form-group">
                                    <label for="informacoesEmpresa">Necessidades EspecÃ­ficas</label>
                                    <textarea id="informacoesEmpresa" name="informacoes" placeholder="Descreva as necessidades especÃ­ficas da empresa, tipos de profissionais procurados, requisitos especiais e outras informaÃ§Ãµes relevantes"></textarea>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" id="registerBtn">
                                <span class="btn-text">Cadastrar InformaÃ§Ãµes</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/logo-arp.png" 
                     alt="Logo Capacita TG">
                <h3 id="successTitle">InformaÃ§Ãµes Cadastradas!</h3>
                <p id="successMessage">Seus dados foram registrados com sucesso!</p>
            </div>
            <div class="modal-content">
                <div class="modal-info" id="userDataDisplay">
                    </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-success" id="closeSuccessModal">Continuar</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="errorModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/logo-arp.png"
                     alt="Logo Capacita TG">
                <h3 id="errorTitle">Erro</h3>
                <p id="errorMessage">Ocorreu um erro. Por favor, tente novamente.</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="closeErrorModal">Fechar</button>
            </div>
        </div>
    </div>

    <footer id="contato">
        <div class="container">
            <div class="footer-content">
                <div class="footer-col">
                    <h3>Capacita Arapiraca</h3>
                    <p>Sua jornada de sucesso comeÃ§a aqui.</p>
                    <p><span itemprop="streetAddress">R. Eng. Godilho de Castro, 1234 - Centro, Arapiraca - AL, 57300-100</span>,
                </div>
                <div class="footer-col">
                    <h4>Links RÃ¡pidos</h4>
                    <ul>
                        <li><a href="entrar.html" class="nav-link">Cadastre-se</a></li>
                        <li><a href="index.html#parceiros" class="nav-link">Sobre NÃ³s</a></li>
                        <li><a href="index.html#parceira" class="nav-link">Parceiros</a></li>
                        <li><a href="#contato" class="nav-link">Contato</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contato</h4>
                    <p>Email plataforma: capacitatg@gmail.com</p>
                    <div class="social-links">
                        <a href="https://www.instagram.com/sine_municipal_de_arapiraca/" target="_blank">Instagram</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024-2025 CapacitaARP. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="/src/js/navigation.js"></script>
    <script src="/src/js/header-control.js"></script>
    <script src="/src/js/auth.js"></script>
    <script>
        const CIDADES_TG = Object.freeze({
            'arapiraca': { nome: 'Arapiraca', tg: '07-015' }
        });
    
        class CapacitaTGManager {
            constructor() {
                this.currentCity = null;
                this.currentUserType = null;
                this.init();
            }
    
            init() {
                this.setupEventListeners();
                this.populateCitySelects();
                this.setupFormValidation();
                this.checkAndRedirectIfLoggedIn();
                this.setupFormAnimations();
            }
            
            checkAndRedirectIfLoggedIn() {
                if (window.authSystem && window.authSystem.isLoggedIn()) {
                    window.location.href = 'index.html';
                }
            }

            setupFormAnimations() {
                // Configurar animaÃ§Ãµes de transiÃ§Ã£o entre formulÃ¡rios
                const formToggle = document.querySelector('.form-toggle');
                const loginSection = document.getElementById('loginSection');
                const registerSection = document.getElementById('registerSection');

                // Adicionar classe para controlar a animaÃ§Ã£o da barra
                const showLoginBtn = document.getElementById('showLogin');
                const showRegisterBtn = document.getElementById('showRegister');

                showRegisterBtn.addEventListener('click', () => {
                    formToggle.classList.add('register-active');
                });

                showLoginBtn.addEventListener('click', () => {
                    formToggle.classList.remove('register-active');
                });
            }
    
            populateCitySelects() {
                const selects = ['cidadeAtirador', 'cidadeEmpresa'];
                
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (!select) return;
    
                    select.innerHTML = '<option value="">Selecione a cidade</option>';
                    const fragment = document.createDocumentFragment();
                    
                    Object.entries(CIDADES_TG).forEach(([key, { nome, tg }]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = nome;
                        option.dataset.tg = tg;
                        fragment.appendChild(option);
                    });
    
                    select.appendChild(fragment);
                });
            }
    
            setupEventListeners() {
                document.getElementById('showLogin').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.toggleForm('login');
                });
                document.getElementById('showRegister').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.toggleForm('register');
                });
    
                document.getElementById('closeErrorModal').addEventListener('click', () => this.hideModal('errorModal'));
                document.getElementById('closeSuccessModal').addEventListener('click', () => {
                    this.hideModal('successModal');
                    // Redirecionar para pÃ¡gina inicial apÃ³s sucesso
                    if (window.authSystem && window.authSystem.isLoggedIn()) {
                        window.location.href = 'index.html';
                    }
                });
    
                document.getElementById('loginForm').addEventListener('submit', this.handleLogin.bind(this));
                document.getElementById('registerForm').addEventListener('submit', this.handleRegister.bind(this));
                document.getElementById('registerForm').addEventListener('change', this.handleRegistrationChanges.bind(this));
    
                document.addEventListener('input', this.handleInputEvents.bind(this));
                document.addEventListener('click', this.handleClickEvents.bind(this));

                // Event listeners para fechar modais clicando no overlay
                document.querySelectorAll('.modal-overlay').forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            this.hideModal(overlay.id);
                        }
                    });
                });
            }
            
            toggleForm(formType) {
                const loginBtn = document.getElementById('showLogin');
                const registerBtn = document.getElementById('showRegister');
                const loginSection = document.getElementById('loginSection');
                const registerSection = document.getElementById('registerSection');
                
                // Adicionar classe de saÃ­da para animaÃ§Ã£o
                const currentActive = document.querySelector('.form-section.active');
                if (currentActive) {
                    currentActive.classList.add('leaving');
                    setTimeout(() => {
                        currentActive.classList.remove('active', 'leaving');
                    }, 300);
                }

                // Atualizar botÃµes
                if (formType === 'login') {
                    loginBtn.classList.add('active');
                    registerBtn.classList.remove('active');
                    
                    setTimeout(() => {
                        loginSection.classList.add('active', 'entering');
                        setTimeout(() => {
                            loginSection.classList.remove('entering');
                        }, 400);
                    }, 150);
                } else {
                    registerBtn.classList.add('active');
                    loginBtn.classList.remove('active');
                    
                    setTimeout(() => {
                        registerSection.classList.add('active', 'entering');
                        setTimeout(() => {
                            registerSection.classList.remove('entering');
                        }, 400);
                    }, 150);
                }
            }
            
            async handleLogin(event) {
                event.preventDefault();
                
                const form = event.target;
                const email = form.loginEmail.value;
                const senha = form.loginSenha.value;
                const loginBtn = document.getElementById('loginBtn');
                
                // ValidaÃ§Ã£o bÃ¡sica
                if (!email || !senha) {
                    this.showFieldError('loginEmail', 'Email Ã© obrigatÃ³rio');
                    this.showFieldError('loginSenha', 'Senha Ã© obrigatÃ³ria');
                    return;
                }

                // Limpar erros anteriores
                this.clearFieldErrors();
                
                this.showLoadingState(true, loginBtn);
                
                try {
                    const result = await window.authSystem.login(email, senha);
                    
                    if (result.success) {
                        this.showSuccessModal('Login Realizado!', result.message);
                        form.reset();
                    } else {
                        this.showErrorMessage(result.error);
                    }
                } catch (error) {
                    console.error('Erro no login:', error);
                    this.showErrorMessage('Erro de conexÃ£o. Tente novamente.');
                } finally {
                    this.showLoadingState(false, loginBtn);
                }
            }
    
            handleRegistrationChanges(event) {
                const { target } = event;
                
                switch (target.name) {
                    case 'tipoUsuario':
                        this.handleUserTypeChange(target.value);
                        break;
                    case 'cidade':
                        this.handleCityChange(target.value);
                        break;
                }
            }
    
            handleUserTypeChange(userType) {
                this.currentUserType = userType;
                this.toggleUserTypeFields(userType);
                this.setRequiredFields(userType);
            }
    
            handleCityChange(cityKey) {
                this.currentCity = cityKey;
            }
    
            handleInputEvents(event) {
                const { target } = event;
                
                if (target.id === 'telefoneAtirador') {
                    this.applyPhoneMask(target);
                }
            }
                // Limpar erro quando o usuÃ¡rio comeÃ§ar a digitar
                if (target.classList.contains('error')) {
                    this.clearFieldError(target);
                }
            
            handleClickEvents(event) {
                const { target } = event;
                
                // Remover validaÃ§Ã£o visual quando clicar em campos
                if (target.tagName === 'INPUT' || target.tagName === 'SELECT' || target.tagName === 'TEXTAREA') {
                    this.clearFieldError(target);
                }
            }
    
            applyPhoneMask(input) {
                let value = input.value.replace(/\D/g, '');
                
                if (value.length > 11) {
                    value = value.slice(0, 11);
                }
                
                if (value.length >= 11) {
                    input.value = value.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 10) {
                    input.value = value.replace(/^(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 6) {
                    input.value = value.replace(/^(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
                } else if (value.length >= 2) {
                    input.value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
                } else {
                    input.value = value;
                }
            }
    
            toggleUserTypeFields(userType) {
                const fieldsMap = {
                    'atirador': 'atiradorFields',
                    'empregador': 'empresaFields'
                };
    
                Object.values(fieldsMap).forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.classList.remove('active');
                });
    
                const targetField = document.getElementById(fieldsMap[userType]);
                if (targetField) {
                    setTimeout(() => targetField.classList.add('active'), 50);
                }
            }
    
            setRequiredFields(userType) {
                document.querySelectorAll('.dynamic-fields input, .dynamic-fields textarea, .dynamic-fields select')
                    .forEach(field => field.removeAttribute('required'));
    
                const requiredFields = {
                    'atirador': ['nomeAtirador', 'cidadeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador', 'senhaAtirador'],
                    'empregador': ['nomeEmpresa', 'cidadeEmpresa', 'emailEmpresa', 'senhaEmpresa']
                };
    
                requiredFields[userType]?.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.setAttribute('required', '');
                });
            }
    
            setupFormValidation() {
                const form = document.getElementById('registerForm');
                if (!form) return;
    
                form.addEventListener('invalid', (event) => {
                    event.preventDefault();
                    this.showFieldError(event.target.id, 'Este campo Ã© obrigatÃ³rio');
                }, true);
            }
    
            showFieldError(fieldId, message) {
                const field = document.getElementById(fieldId);
                const formGroup = field?.closest('.form-group');
                const feedback = formGroup?.querySelector('.input-feedback');
                
                if (formGroup && feedback) {
                    formGroup.classList.add('error');
                    feedback.textContent = message;
                    feedback.classList.add('show');
                    field.focus();
                }
            }

            clearFieldError(field) {
                const formGroup = field.closest('.form-group');
                const feedback = formGroup?.querySelector('.input-feedback');
                
                if (formGroup && feedback) {
                    formGroup.classList.remove('error');
                    feedback.classList.remove('show');
                }
            }

            clearFieldErrors() {
                document.querySelectorAll('.form-group.error').forEach(group => {
                    group.classList.remove('error');
                    const feedback = group.querySelector('.input-feedback');
                    if (feedback) feedback.classList.remove('show');
                });
            }
            
            async handleRegister(event) {
                event.preventDefault();
                
                if (!this.validateRegistrationForm()) return;
    
                const userData = this.collectRegistrationData();
                await this.submitRegistration(userData);
            }
    
            validateRegistrationForm() {
                const form = document.getElementById('registerForm');
                let isValid = true;

                // Limpar erros anteriores
                this.clearFieldErrors();

                // Validar tipo de usuÃ¡rio
                if (!this.currentUserType) {
                    this.showErrorMessage('Por favor, selecione o tipo de usuÃ¡rio.');
                    return false;
                }

                // Validar cidade
                if (!this.currentCity) {
                    this.showErrorMessage('Por favor, selecione uma cidade vÃ¡lida.');
                    return false;
                }

                // Validar campos obrigatÃ³rios
                const requiredFields = this.getRequiredFieldsForUserType(this.currentUserType);
                requiredFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field && !field.value.trim()) {
                        this.showFieldError(fieldId, 'Este campo Ã© obrigatÃ³rio');
                        isValid = false;
                    }
                });

                // ValidaÃ§Ãµes especÃ­ficas
                if (this.currentUserType === 'atirador') {
                    const email = document.getElementById('emailAtirador').value;
                    const senha = document.getElementById('senhaAtirador').value;
                    const telefone = document.getElementById('telefoneAtirador').value;

                    if (email && !this.isValidEmail(email)) {
                        this.showFieldError('emailAtirador', 'Email invÃ¡lido');
                        isValid = false;
                    }

                    if (senha && !this.isValidPassword(senha)) {
                        this.showFieldError('senhaAtirador', 'Senha deve ter pelo menos 6 caracteres, incluindo maiÃºscula, minÃºscula e nÃºmero');
                        isValid = false;
                    }

                    if (telefone && telefone.length < 14) {
                        this.showFieldError('telefoneAtirador', 'Telefone invÃ¡lido');
                        isValid = false;
                    }
                } else if (this.currentUserType === 'empregador') {
                    const email = document.getElementById('emailEmpresa').value;
                    const senha = document.getElementById('senhaEmpresa').value;

                    if (email && !this.isValidEmail(email)) {
                        this.showFieldError('emailEmpresa', 'Email invÃ¡lido');
                        isValid = false;
                    }

                    if (senha && !this.isValidPassword(senha)) {
                        this.showFieldError('senhaEmpresa', 'Senha deve ter pelo menos 6 caracteres, incluindo maiÃºscula, minÃºscula e nÃºmero');
                        isValid = false;
                    }
                }
                
                return isValid;
            }

            getRequiredFieldsForUserType(userType) {
                const requiredFields = {
                    'atirador': ['nomeAtirador', 'cidadeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador', 'senhaAtirador'],
                    'empregador': ['nomeEmpresa', 'cidadeEmpresa', 'emailEmpresa', 'senhaEmpresa']
                };
                return requiredFields[userType] || [];
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            isValidPassword(password) {
                // Pelo menos 6 caracteres, uma maiÃºscula, uma minÃºscula e um nÃºmero
                const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;
                return passwordRegex.test(password);
            }

            async submitRegistration(userData) {
                const registerBtn = document.getElementById('registerBtn');
                this.showLoadingState(true, registerBtn);
                
                try {
                    let result;
                    
                    if (userData.tipoUsuario === 'atirador') {
                        result = await window.authSystem.registerStudent(userData);
                    } else {
                        result = await window.authSystem.registerCompany(userData);
                    }
                    
                    if (result.success) {
                        this.showSuccessModal('Cadastro Realizado!', result.message, result.user);
                        this.clearRegistrationForm();
                    } else {
                        if (result.details && Array.isArray(result.details)) {
                            // Mostrar erros de validaÃ§Ã£o especÃ­ficos
                            result.details.forEach(detail => {
                                const fieldMap = {
                                    'nome': 'nomeAtirador',
                                    'nomeEmpresa': 'nomeEmpresa',
                                    'email': userData.tipoUsuario === 'atirador' ? 'emailAtirador' : 'emailEmpresa',
                                    'senha': userData.tipoUsuario === 'atirador' ? 'senhaAtirador' : 'senhaEmpresa',
                                    'telefone': 'telefoneAtirador',
                                    'cidade': userData.tipoUsuario === 'atirador' ? 'cidadeAtirador' : 'cidadeEmpresa',
                                    'habilidades': 'habilidadesAtirador'
                                };
                                
                                const fieldId = fieldMap[detail.path] || detail.path;
                                if (fieldId) {
                                    this.showFieldError(fieldId, detail.msg);
                                }
                            });
                        } else {
                            this.showErrorMessage(result.error);
                        }
                    }
                } catch (error) {
                    console.error('Erro no cadastro:', error);
                    this.showErrorMessage('Erro de conexÃ£o. Tente novamente.');
                } finally {
                    this.showLoadingState(false, registerBtn);
                }
            }
    
            collectRegistrationData() {
                const userType = this.currentUserType;
                const cityData = CIDADES_TG[this.currentCity];
                
                const baseData = {
                    tipoUsuario: userType,
                    cidade: cityData.nome,
                    cidadeKey: this.currentCity,
                    tg: cityData.tg
                };
    
                if (userType === 'atirador') {
                    return {
                        ...baseData,
                        ...this.getAtiradorData()
                    };
                } else {
                    return {
                        ...baseData,
                        ...this.getEmpresaData()
                    };
                }
            }
    
            getAtiradorData() {
                const fields = ['nomeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador', 'experienciaAtirador', 'formacaoAtirador', 'senhaAtirador'];
                const data = {};
    
                fields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element) {
                        const key = field.replace('Atirador', '');
                        data[key] = element.value.trim();
                    }
                });
    
                return data;
            }
    
            getEmpresaData() {
                const fieldMap = {
                    'nomeEmpresa': 'nomeEmpresa',
                    'emailEmpresa': 'email',
                    'informacoesEmpresa': 'informacoes',
                    'senhaEmpresa': 'senha'
                };
    
                const data = {};
                Object.entries(fieldMap).forEach(([elementId, dataKey]) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        data[dataKey] = element.value.trim();
                    }
                });
    
                return data;
            }
    
            showLoadingState(show, button) {
                const btnText = button.querySelector('.btn-text');
                
                if (show) {
                    button.disabled = true;
                    button.classList.add('loading');
                    if (btnText) btnText.textContent = 'Aguarde...';
                } else {
                    button.disabled = false;
                    button.classList.remove('loading');
                    if (btnText) {
                        if (button.id === 'loginBtn') {
                            btnText.textContent = 'Acessar';
                        } else {
                            btnText.textContent = 'Cadastrar InformaÃ§Ãµes';
                        }
                    }
                }
            }

            showSuccessModal(title, message, userData = null) {
                document.getElementById('successTitle').textContent = title;
                document.getElementById('successMessage').textContent = message;
                
                if (userData) {
                    const modalInfo = this.buildSuccessModalContent(userData);
                    const userDataDisplay = document.getElementById('userDataDisplay');
                    if (userDataDisplay) {
                        userDataDisplay.innerHTML = modalInfo.dataHTML;
                    }
                }
                
                this.showModal('successModal');
            }

            buildSuccessModalContent(userData) {
                const isAtirador = userData.tipo === 'atirador' || userData.tipoUsuario === 'atirador';
                
                const dataHTML = isAtirador ? `
                    <p><strong>Nome:</strong> ${userData.nome}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Telefone:</strong> ${userData.telefone || 'NÃ£o informado'}</p>
                    <p><strong>Tipo:</strong> Aluno</p>
                ` : `
                    <p><strong>Empresa:</strong> ${userData.nomeEmpresa}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Tipo:</strong> Empresa</p>
                `;

                return { dataHTML };
            }
    
            showErrorMessage(message) {
                const errorModal = document.getElementById('errorModal');
                const errorTitle = document.getElementById('errorTitle');
                const errorMessage = document.getElementById('errorMessage');
                
                if (errorTitle) errorTitle.textContent = 'Erro';
                if (errorMessage) errorMessage.textContent = message;
                
                this.showModal('errorModal');
            }
    
            clearRegistrationForm() {
                const form = document.getElementById('registerForm');
                if (form) {
                    form.reset();
                    this.currentCity = null;
                    this.currentUserType = null;
                    
                    // Limpar erros
                    this.clearFieldErrors();
                    
                    // Ocultar campos dinÃ¢micos
                    ['atiradorFields', 'empresaFields'].forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.classList.remove('active');
                    });
                    
                    // Remover seleÃ§Ã£o de tipo de usuÃ¡rio
                    document.querySelectorAll('input[name="tipoUsuario"]').forEach(radio => {
                        radio.checked = false;
                    });
                }
            }
    
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }
    
            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
        }
    
        // Inicializar quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', () => {
            new CapacitaTGManager();
        });
    </script>
</body>
</html>
@@ .. @@
                    <div class="form-section active" id="loginSection">
                        <form class="login-form" id="loginForm">
                            <div class="form-group">
                                <label for="loginEmail">E-mail</label>
                                <input type="email" id="loginEmail" name="email" placeholder="Digite seu e-mail" required>
                                <span class="input-feedback" id="loginEmailFeedback">E-mail nÃ£o pode ficar vazio.</span>
                            </div>

                            <div class="form-group">
                                <label for="loginSenha">Senha</label>
                                <input type="password" id="loginSenha" name="senha" placeholder="Digite sua senha" required>
                                <span class="input-feedback" id="loginSenhaFeedback">Senha nÃ£o pode ficar vazia.</span>
                            </div>

                            <button type="submit" class="btn btn-primary" id="loginBtn">
                                <span class="btn-text">Acessar</span>
                            </button>
                        </form>
                    </div>
@@ .. @@
                            <button type="submit" class="btn btn-primary" id="registerBtn">
                                <span class="btn-text">Cadastrar InformaÃ§Ãµes</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/logo-arp.png" 
                     alt="Logo Capacita TG">
                <h3 id="successTitle">InformaÃ§Ãµes Cadastradas!</h3>
                <p id="successMessage">Seus dados foram registrados com sucesso!</p>
            </div>
            <div class="modal-content">
                <div class="modal-info" id="userDataDisplay">
                    </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-success" id="closeSuccessModal">Continuar</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="errorModal">
        <div class="modal">
            <div class="modal-header">
                <img src="/src/imgs/logo-arp.png"
                     alt="Logo Capacita TG">
                <h3 id="errorTitle">Erro</h3>
                <p id="errorMessage">Ocorreu um erro. Por favor, tente novamente.</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="closeErrorModal">Fechar</button>
            </div>
        </div>
    </div>
@@ .. @@
    <script src="/src/js/navigation.js"></script>
    <script src="/src/js/header-control.js"></script>
    <script src="/src/js/auth.js"></script>
    <script>
        const CIDADES_TG = Object.freeze({
            'arapiraca': { nome: 'Arapiraca', tg: '07-015' }
        });
    
        class CapacitaTGManager {
            constructor() {
                this.currentCity = null;
                this.currentUserType = null;
                this.init();
            }
    
            init() {
                this.setupEventListeners();
                this.populateCitySelects();
                this.setupFormValidation();
                this.checkAndRedirectIfLoggedIn();
                this.setupFormAnimations();
            }
            
            checkAndRedirectIfLoggedIn() {
                if (window.authSystem && window.authSystem.isLoggedIn()) {
                    window.location.href = 'index.html';
                }
            }

            setupFormAnimations() {
                // Configurar animaÃ§Ãµes de transiÃ§Ã£o entre formulÃ¡rios
                const formToggle = document.querySelector('.form-toggle');
                const loginSection = document.getElementById('loginSection');
                const registerSection = document.getElementById('registerSection');

                // Adicionar classe para controlar a animaÃ§Ã£o da barra
                const showLoginBtn = document.getElementById('showLogin');
                const showRegisterBtn = document.getElementById('showRegister');

                showRegisterBtn.addEventListener('click', () => {
                    formToggle.classList.add('register-active');
                });

                showLoginBtn.addEventListener('click', () => {
                    formToggle.classList.remove('register-active');
                });
            }
    
            populateCitySelects() {
                const selects = ['cidadeAtirador', 'cidadeEmpresa'];
                
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (!select) return;
    
                    select.innerHTML = '<option value="">Selecione a cidade</option>';
                    const fragment = document.createDocumentFragment();
                    
                    Object.entries(CIDADES_TG).forEach(([key, { nome, tg }]) => {
                        const option = document.createElement('option');
                        option.value = key;
                        option.textContent = nome;
                        option.dataset.tg = tg;
                        fragment.appendChild(option);
                    });
    
                    select.appendChild(fragment);
                });
            }
    
            setupEventListeners() {
                document.getElementById('showLogin').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.toggleForm('login');
                });
                document.getElementById('showRegister').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.toggleForm('register');
                });
    
                document.getElementById('closeErrorModal').addEventListener('click', () => this.hideModal('errorModal'));
                document.getElementById('closeSuccessModal').addEventListener('click', () => {
                    this.hideModal('successModal');
                    // Redirecionar para pÃ¡gina inicial apÃ³s sucesso
                    if (window.authSystem && window.authSystem.isLoggedIn()) {
                        window.location.href = 'index.html';
                    }
                });
    
                document.getElementById('loginForm').addEventListener('submit', this.handleLogin.bind(this));
                document.getElementById('registerForm').addEventListener('submit', this.handleRegister.bind(this));
                document.getElementById('registerForm').addEventListener('change', this.handleRegistrationChanges.bind(this));
    
                document.addEventListener('input', this.handleInputEvents.bind(this));
                document.addEventListener('click', this.handleClickEvents.bind(this));

                // Event listeners para fechar modais clicando no overlay
                document.querySelectorAll('.modal-overlay').forEach(overlay => {
                    overlay.addEventListener('click', (e) => {
                        if (e.target === overlay) {
                            this.hideModal(overlay.id);
                        }
                    });
                });
            }
            
            toggleForm(formType) {
                const loginBtn = document.getElementById('showLogin');
                const registerBtn = document.getElementById('showRegister');
                const loginSection = document.getElementById('loginSection');
                const registerSection = document.getElementById('registerSection');
                
                // Adicionar classe de saÃ­da para animaÃ§Ã£o
                const currentActive = document.querySelector('.form-section.active');
                if (currentActive) {
                    currentActive.classList.add('leaving');
                    setTimeout(() => {
                        currentActive.classList.remove('active', 'leaving');
                    }, 300);
                }

                // Atualizar botÃµes
                if (formType === 'login') {
                    loginBtn.classList.add('active');
                    registerBtn.classList.remove('active');
                    
                    setTimeout(() => {
                        loginSection.classList.add('active', 'entering');
                        setTimeout(() => {
                            loginSection.classList.remove('entering');
                        }, 400);
                    }, 150);
                    } else {
                        button.textContent = 'Cadastrar InformaÃ§Ãµes';
                    registerBtn.classList.add('active');
                    loginBtn.classList.remove('active');
                    
                    setTimeout(() => {
                        registerSection.classList.add('active', 'entering');
                        setTimeout(() => {
                            registerSection.classList.remove('entering');
                        }, 400);
                    }, 150);
                }
            }
            
            async handleLogin(event) {
                event.preventDefault();
                
                const form = event.target;
                const email = form.loginEmail.value.trim();
                const senha = form.loginSenha.value;
                const loginBtn = document.getElementById('loginBtn');
                
                // ValidaÃ§Ã£o bÃ¡sica
                if (!email || !senha) {
                    this.showFieldError('loginEmail', 'Email Ã© obrigatÃ³rio');
                    this.showFieldError('loginSenha', 'Senha Ã© obrigatÃ³ria');
                    return;
                }

                // Limpar erros anteriores
                this.clearFieldErrors();
                
                this.showLoadingState(true, loginBtn);
                
                try {
                    const result = await window.authSystem.login(email, senha);
                    
                    if (result.success) {
                        this.showSuccessModal('Login Realizado!', result.message);
                        form.reset();
                    } else {
                        this.showErrorMessage(result.error);
                    }
                } catch (error) {
                    console.error('Erro no login:', error);
                    this.showErrorMessage('Erro de conexÃ£o. Tente novamente.');
                } finally {
                    this.showLoadingState(false, loginBtn);
                }
            }
    
            handleRegistrationChanges(event) {
                const { target } = event;
                
                switch (target.name) {
                    case 'tipoUsuario':
                        this.handleUserTypeChange(target.value);
                        break;
                    case 'cidade':
                        this.handleCityChange(target.value);
                        break;
                }
            }
    
            handleUserTypeChange(userType) {
                this.currentUserType = userType;
                this.toggleUserTypeFields(userType);
                this.setRequiredFields(userType);
            }
    
            handleCityChange(cityKey) {
                this.currentCity = cityKey;
            }
    
            handleInputEvents(event) {
                const { target } = event;
                
                if (target.id === 'telefoneAtirador') {
                    this.applyPhoneMask(target);
                }

                // Limpar erro quando o usuÃ¡rio comeÃ§ar a digitar
                if (target.classList.contains('error')) {
                    this.clearFieldError(target);
                }
            }
            
            handleClickEvents(event) {
                const { target } = event;
                
                // Remover validaÃ§Ã£o visual quando clicar em campos
                if (target.tagName === 'INPUT' || target.tagName === 'SELECT' || target.tagName === 'TEXTAREA') {
                    this.clearFieldError(target);
                }
            }
    
            applyPhoneMask(input) {
                let value = input.value.replace(/\D/g, '');
                
                if (value.length > 11) {
                    value = value.slice(0, 11);
                }
                
                if (value.length >= 11) {
                    input.value = value.replace(/^(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 10) {
                    input.value = value.replace(/^(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                } else if (value.length >= 6) {
                    input.value = value.replace(/^(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
                } else if (value.length >= 2) {
                    input.value = value.replace(/^(\d{2})(\d{0,5})/, '($1) $2');
                } else {
                    input.value = value;
                }
            }
    
            toggleUserTypeFields(userType) {
                const fieldsMap = {
                    'atirador': 'atiradorFields',
                    'empregador': 'empresaFields'
                };
    
                Object.values(fieldsMap).forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.classList.remove('active');
                });
    
                const targetField = document.getElementById(fieldsMap[userType]);
                if (targetField) {
                    setTimeout(() => targetField.classList.add('active'), 50);
                }
            }
    
            setRequiredFields(userType) {
                document.querySelectorAll('.dynamic-fields input, .dynamic-fields textarea, .dynamic-fields select')
                    .forEach(field => field.removeAttribute('required'));
    
                const requiredFields = {
                    'atirador': ['nomeAtirador', 'cidadeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador', 'senhaAtirador'],
                    'empregador': ['nomeEmpresa', 'cidadeEmpresa', 'emailEmpresa', 'senhaEmpresa']
                };
    
                requiredFields[userType]?.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) field.setAttribute('required', '');
                });
            }
    
            setupFormValidation() {
                const form = document.getElementById('registerForm');
                if (!form) return;
    
                form.addEventListener('invalid', (event) => {
                    event.preventDefault();
                    this.showFieldError(event.target.id, 'Este campo Ã© obrigatÃ³rio');
                }, true);
            }
    
            showFieldError(fieldId, message) {
                const field = document.getElementById(fieldId);
                const formGroup = field?.closest('.form-group');
                const feedback = formGroup?.querySelector('.input-feedback');
                
                if (formGroup && feedback) {
                    formGroup.classList.add('error');
                    feedback.textContent = message;
                    feedback.classList.add('show');
                    field.focus();
                }
            }

            clearFieldError(field) {
                const formGroup = field.closest('.form-group');
                const feedback = formGroup?.querySelector('.input-feedback');
                
                if (formGroup && feedback) {
                    formGroup.classList.remove('error');
                    feedback.classList.remove('show');
                }
            }

            clearFieldErrors() {
                document.querySelectorAll('.form-group.error').forEach(group => {
                    group.classList.remove('error');
                    const feedback = group.querySelector('.input-feedback');
                    if (feedback) feedback.classList.remove('show');
                });
            }
            
            async handleRegister(event) {
                event.preventDefault();
                
                if (!this.validateRegistrationForm()) return;
    
                const userData = this.collectRegistrationData();
                await this.submitRegistration(userData);
            }
    
            validateRegistrationForm() {
                const form = document.getElementById('registerForm');
                let isValid = true;

                // Limpar erros anteriores
                this.clearFieldErrors();

                // Validar tipo de usuÃ¡rio
                if (!this.currentUserType) {
                    this.showErrorMessage('Por favor, selecione o tipo de usuÃ¡rio.');
                    return false;
                }

                // Validar cidade
                if (!this.currentCity) {
                    this.showErrorMessage('Por favor, selecione uma cidade vÃ¡lida.');
                    return false;
                }

                // Validar campos obrigatÃ³rios
                const requiredFields = this.getRequiredFieldsForUserType(this.currentUserType);
                requiredFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field && !field.value.trim()) {
                        this.showFieldError(fieldId, 'Este campo Ã© obrigatÃ³rio');
                        isValid = false;
                    }
                });

                // ValidaÃ§Ãµes especÃ­ficas
                if (this.currentUserType === 'atirador') {
                    const email = document.getElementById('emailAtirador').value;
                    const senha = document.getElementById('senhaAtirador').value;
                    const telefone = document.getElementById('telefoneAtirador').value;

                    if (email && !this.isValidEmail(email)) {
                        this.showFieldError('emailAtirador', 'Email invÃ¡lido');
                        isValid = false;
                    }

                    if (senha && !this.isValidPassword(senha)) {
                        this.showFieldError('senhaAtirador', 'Senha deve ter pelo menos 6 caracteres, incluindo maiÃºscula, minÃºscula e nÃºmero');
                        isValid = false;
                    }

                    if (telefone && telefone.length < 14) {
                        this.showFieldError('telefoneAtirador', 'Telefone invÃ¡lido');
                        isValid = false;
                    }
                } else if (this.currentUserType === 'empregador') {
                    const email = document.getElementById('emailEmpresa').value;
                    const senha = document.getElementById('senhaEmpresa').value;

                    if (email && !this.isValidEmail(email)) {
                        this.showFieldError('emailEmpresa', 'Email invÃ¡lido');
                        isValid = false;
                    }

                    if (senha && !this.isValidPassword(senha)) {
                        this.showFieldError('senhaEmpresa', 'Senha deve ter pelo menos 6 caracteres, incluindo maiÃºscula, minÃºscula e nÃºmero');
                        isValid = false;
                    }
                }
                
                return isValid;
            }

            getRequiredFieldsForUserType(userType) {
                const requiredFields = {
                    'atirador': ['nomeAtirador', 'cidadeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador', 'senhaAtirador'],
                    'empregador': ['nomeEmpresa', 'cidadeEmpresa', 'emailEmpresa', 'senhaEmpresa']
                };
                return requiredFields[userType] || [];
            }

            isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            isValidPassword(password) {
                // Pelo menos 6 caracteres, uma maiÃºscula, uma minÃºscula e um nÃºmero
                const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;
                return passwordRegex.test(password);
            }

            async submitRegistration(userData) {
                const registerBtn = document.getElementById('registerBtn');
                this.showLoadingState(true, registerBtn);
                
                try {
                    let result;
                    
                    if (userData.tipoUsuario === 'atirador') {
                        result = await window.authSystem.registerStudent(userData);
                    } else {
                        result = await window.authSystem.registerCompany(userData);
                    }
                    
                    if (result.success) {
                        this.showSuccessModal('Cadastro Realizado!', result.message, result.user);
                        this.clearRegistrationForm();
                    } else {
                        if (result.details && Array.isArray(result.details)) {
                            // Mostrar erros de validaÃ§Ã£o especÃ­ficos
                            result.details.forEach(detail => {
                                const fieldMap = {
                                    'nome': 'nomeAtirador',
                                    'nomeEmpresa': 'nomeEmpresa',
                                    'email': userData.tipoUsuario === 'atirador' ? 'emailAtirador' : 'emailEmpresa',
                                    'senha': userData.tipoUsuario === 'atirador' ? 'senhaAtirador' : 'senhaEmpresa',
                                    'telefone': 'telefoneAtirador',
                                    'cidade': userData.tipoUsuario === 'atirador' ? 'cidadeAtirador' : 'cidadeEmpresa',
                                    'habilidades': 'habilidadesAtirador'
                                };
                                
                                const fieldId = fieldMap[detail.path] || detail.path;
                                if (fieldId) {
                                    this.showFieldError(fieldId, detail.msg);
                                }
                            });
                        } else {
                            this.showErrorMessage(result.error);
                        }
                    }
                } catch (error) {
                    console.error('Erro no cadastro:', error);
                    this.showErrorMessage('Erro de conexÃ£o. Tente novamente.');
                } finally {
                    this.showLoadingState(false, registerBtn);
                }
            }
    
            collectRegistrationData() {
                const userType = this.currentUserType;
                const cityData = CIDADES_TG[this.currentCity];
                
                const baseData = {
                    tipoUsuario: userType,
                    cidade: cityData.nome,
                    cidadeKey: this.currentCity,
                    tg: cityData.tg
                };
    
                if (userType === 'atirador') {
                    return {
                        ...baseData,
                        ...this.getAtiradorData()
                    };
                } else {
                    return {
                        ...baseData,
                        ...this.getEmpresaData()
                    };
                }
            }
    
            getAtiradorData() {
                const fields = ['nomeAtirador', 'emailAtirador', 'telefoneAtirador', 'habilidadesAtirador', 'experienciaAtirador', 'formacaoAtirador', 'senhaAtirador'];
                const data = {};
    
                fields.forEach(field => {
                    const element = document.getElementById(field);
                    if (element) {
                        const key = field.replace('Atirador', '');
                        data[key] = element.value.trim();
                    }
                });
    
                return data;
            }
    
            getEmpresaData() {
                const fieldMap = {
                    'nomeEmpresa': 'nomeEmpresa',
                    'emailEmpresa': 'email',
                    'informacoesEmpresa': 'informacoes',
                    'senhaEmpresa': 'senha'
                };
    
                const data = {};
                Object.entries(fieldMap).forEach(([elementId, dataKey]) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        data[dataKey] = element.value.trim();
                    }
                });
    
                return data;
            }
    
            showLoadingState(show, button) {
                const btnText = button.querySelector('.btn-text');
                
                if (show) {
                    button.disabled = true;
                    button.classList.add('loading');
                    if (btnText) btnText.textContent = 'Aguarde...';
                } else {
                    button.disabled = false;
                    button.classList.remove('loading');
                    if (btnText) {
                        if (button.id === 'loginBtn') {
                            btnText.textContent = 'Acessar';
                        } else {
                            btnText.textContent = 'Cadastrar InformaÃ§Ãµes';
                        }
                    }
                }
            }

            showSuccessModal(title, message, userData = null) {
                document.getElementById('successTitle').textContent = title;
                document.getElementById('successMessage').textContent = message;
                
                if (userData) {
                    const modalInfo = this.buildSuccessModalContent(userData);
                    const userDataDisplay = document.getElementById('userDataDisplay');
                    if (userDataDisplay) {
                        userDataDisplay.innerHTML = modalInfo.dataHTML;
                    }
                }
                
                this.showModal('successModal');
            }

            buildSuccessModalContent(userData) {
                const isAtirador = userData.tipo === 'atirador' || userData.tipoUsuario === 'atirador';
                
                const dataHTML = isAtirador ? `
                    <p><strong>Nome:</strong> ${userData.nome}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Telefone:</strong> ${userData.telefone || 'NÃ£o informado'}</p>
                    <p><strong>Tipo:</strong> Aluno</p>
                ` : `
                    <p><strong>Empresa:</strong> ${userData.nomeEmpresa}</p>
                    <p><strong>Cidade:</strong> ${userData.cidade}</p>
                    <p><strong>Email:</strong> ${userData.email}</p>
                    <p><strong>Tipo:</strong> Empresa</p>
                `;

                return { dataHTML };
            }
    
            showErrorMessage(message) {
                const errorModal = document.getElementById('errorModal');
                const errorTitle = document.getElementById('errorTitle');
                const errorMessage = document.getElementById('errorMessage');
                
                if (errorTitle) errorTitle.textContent = 'Erro';
                if (errorMessage) errorMessage.textContent = message;
                
                this.showModal('errorModal');
            }
    
            clearRegistrationForm() {
                const form = document.getElementById('registerForm');
                if (form) {
                    form.reset();
                    this.currentCity = null;
                    this.currentUserType = null;
                    
                    // Limpar erros
                    this.clearFieldErrors();
                    
                    // Ocultar campos dinÃ¢micos
                    ['atiradorFields', 'empresaFields'].forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.classList.remove('active');
                    });
                    
                    // Remover seleÃ§Ã£o de tipo de usuÃ¡rio
                    document.querySelectorAll('input[name="tipoUsuario"]').forEach(radio => {
                        radio.checked = false;
                    });
                }
            }
    
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }
    
            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                }
            }
        }
    
        // Inicializar quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', () => {
            new CapacitaTGManager();
        });
    </script>
</body>
</html>